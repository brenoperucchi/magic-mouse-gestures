name: Publish package

on:
  workflow_dispatch:
      inputs:
            repository:
                    description: 'Target repository (testpypi or pypi)'
                            required: true
                                    default: 'testpypi'
                                            type: choice
                                                    options:
                                                              - testpypi
                                                                        - pypi

                                                                        jobs:
                                                                          deploy:
                                                                              runs-on: ubuntu-latest
                                                                                  steps:
                                                                                      - uses: actions/checkout@v4

                                                                                          - name: Set up Python
                                                                                                uses: actions/setup-python@v4
                                                                                                      with:
                                                                                                              python-version: '3.x'
                                                                                                              
                                                                                                                  - name: Install dependencies
                                                                                                                        run: |
                                                                                                                                python -m pip install --upgrade pip
                                                                                                                                        pip install build twine
                                                                                                                                        
                                                                                                                                            - name: Build distribution
                                                                                                                                                  run: python -m build
                                                                                                                                                  
                                                                                                                                                      - name: Publish to TestPyPI
                                                                                                                                                            if: ${{ github.event.inputs.repository == 'testpypi' }}
                                                                                                                                                                  env:
                                                                                                                                                                          TWINE_REPOSITORY_URL: https://test.pypi.org/legacy/
                                                                                                                                                                                  TWINE_USERNAME: __token__
                                                                                                                                                                                          TWINE_PASSWORD: ${{ secrets.TESTPYPI_API_TOKEN }}
                                                                                                                                                                                                run: twine upload dist/*
                                                                                                                                                                                                
                                                                                                                                                                                                    - name: Publish to PyPI
                                                                                                                                                                                                          if: ${{ github.event.inputs.repository == 'pypi' }}
                                                                                                                                                                                                                env:
                                                                                                                                                                                                                        TWINE_USERNAME: __token__
                                                                                                                                                                                                                                TWINE_PASSWORD: ${{ secrets.PYPI_API_TOKEN }}
                                                                                                                                                                                                                                      run: twine upload dist/*
